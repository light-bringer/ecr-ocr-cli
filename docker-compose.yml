services:
  electoral-search:
    build:
      context: .
      dockerfile: Dockerfile
    image: electoral-search:latest
    container_name: electoral-search

    # Mount volumes for PDFs and results
    volumes:
      # Mount your PDFs directory (change ./pdfs to your actual path)
      - ./pdfs:/data:ro
      # Mount output directory for results
      - ./output:/output
      # Optional: Mount names file
      - ./names.txt:/data/names.txt:ro

    # Environment variables for configuration
    environment:
      - OCR_DPI=350
      - OCR_LANG=ben
      - MAX_PDF_SIZE_MB=50
      - MAX_PDF_PAGES=100
      - MAX_NAMES_FILE_SIZE_MB=10
      - MAX_SEARCH_NAMES=1000

    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G

    # Override default command
    # Example: search /data --names-file /data/names.txt -o /output/results.json
    command: ["search", "/data", "--names-file", "/data/names.txt", "-o", "/output/results.json", "-v"]

    # Restart policy
    restart: unless-stopped

  # Optional: Interactive shell for debugging
  electoral-search-shell:
    extends: electoral-search
    container_name: electoral-search-shell
    entrypoint: ["/bin/bash"]
    stdin_open: true
    tty: true
    profiles: ["debug"]
